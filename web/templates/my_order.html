{% extends 'home.html' %}
{% load static %}
{% load figure %}
{% load privilege %}
{% load highlight %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/my_order.css' %}">
{% endblock %}

{% block content %}
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            {% add_privilege request 'my_order_add' %}
            <form class="d-flex" role="search" method="get">
                <input class="form-control me-2" name="keyword" type="search" placeholder="请输入关键字" aria-label="Search">
                <button class="btn btn-outline-success" style="white-space: nowrap" type="submit">搜索</button>
            </form>
        </div>
    </nav>
    <div>
        <table class="table table-bordered table-hover table-prior">
            <thead><tr>
                <th scope="col" class="col-1">订单号</th>
                <th scope="col" class="col-1">视频地址</th>
                <th scope="col" class="col-1">原播放量</th>
                <th scope="col" class="col-1">费用</th>
                <th scope="col" class="col-1">订单状态</th>
                <th scope="col" class="col-1">创建日期</th>
                <th scope="col" class="col-1">备注</th>
                <th scope="col" class="col-1">操作</th>
            </tr>
            </thead>
            <tbody class="table-group-divider">
            {% for row in pager.queryset %}
                <tr row-id="{{ row.id }}" row-oid="{{ row.oid }}">
                    <th scope="row">{{ row.oid }}</th>
                    <td><a class="link-info" target="_blank" href="{{ row.url }}" style="text-decoration: none;">前往查看</a></td>
                    <td>{{ row.origin_view_count|as_text:2 }}</td>
                    <td><span style="text-decoration-line: line-through;">{{ row.price }}</span>({{ row.real_price }})￥</td>
                    <td><button class="btn btn-sm btn-{{ row.status|highlight }}">{{ row.get_status_display }}</button></td>
                    <td>{{ row.create_datetime|date:"Y/m/d H:i:s" }}</td>
                    <td>{{ row.memo }}</td>
                    <td>
                        {% if row.status == 1 %}
                            <a class="btn btn-danger btn-sm revoke-btn" id="btn-revoke" data-bs-toggle="modal" data-bs-target="#revokeModal">撤单</a>
{#                            <a href="{% url 'my_order_revoke' pk=row.id %}">#}
{#                                <button class="btn btn-danger btn-sm revoke-btn" id="btn-link-revoke" data-bs-toggle="modal" data-bs-target="#revokeForm">form撤单</button>#}
{#                            </a>#}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div>
        <nav>
            <ul class="pagination justify-content-center">
                {{ pager.page_html_string }}
            </ul>
        </nav>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="revokeModal" tabindex="-1" aria-labelledby="revokeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger">
                    <h1 class="modal-title fs-5" id="revokeModalLabel">警 告</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body bg-danger-subtle">
                    确定要撤单?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="modal-revoke-btn">确 认</button>
                    <button type="button" class="btn btn-dark" data-bs-dismiss="modal" id="modal-cancel-btn">取 消</button>
                    <span class="modal-error-span"></span>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
<script src="{% static 'js/my_order.js' %}"></script>
{% endblock %}